{% extends "base.html" %}
{% block title %}MaITaxI ‚Äî –ë—ã—Å—Ç—Ä–æ–µ —Ç–∞–∫—Å–∏ –≤ –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ{% endblock %}

{% block head %}
    <script src="https://api-maps.yandex.ru/v3/?apikey=ce095acd-05a3-4919-9cf4-7e64c641af28&lang=ru_RU"></script>
{% endblock %}

{% block content %}
        <h1 style="text-align: center; margin-bottom: 30px;">–ó–∞–∫–∞–∑–∞—Ç—å —Ç–∞–∫—Å–∏</h1>
        <form class="order-form" action="{{ url_for('find_car') }}" method="post">
            <div class="form-group">
              <label>—Ç–æ—á–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</label>
              <div class="input-with-map">
                <input id="pointA" name="pointA" type="text" placeholder="–û—Ç–∫—É–¥–∞ –≤–∞—Å –∑–∞–±—Ä–∞—Ç—å?" required autocomplete="off">
                <button style="display: block" type="button" class="map-icon-btn" id="selectPointA" title="–£–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ">üìç</button>
              </div>
              <div id="suggestionsA" class="suggestions"></div>
            </div>

            <div class="form-group">
              <label>—Ç–æ—á–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:</label>
              <div class="input-with-map">
                <input id="pointB" name="pointB" type="text" placeholder="–ö—É–¥–∞ –≤–∞–º –Ω—É–∂–Ω–æ?" required autocomplete="off">
                <button style="display: block" type="button" class="map-icon-btn" id="selectPointB" title="–£–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ">üìç</button>
              </div>
              <div id="suggestionsB" class="suggestions"></div>
            </div>

            <div class="form-group">
                <label>—Ç–∏–ø –∞–≤—Ç–æ–º–æ–±–∏–ª—è:</label>
                <div class="car-type-options">
                    <input type="hidden" name="carType" id="carTypeValue" value="econom">

                    <div class="car-tile active" data-type="econom">
                        <i class="fas fa-car-side"></i>
                        <span>–≠–∫–æ–Ω–æ–º</span>
                    </div>
                    <div class="car-tile" data-type="comfort">
                        <i class="fas fa-car"></i>
                        <span>–ö–æ–º—Ñ–æ—Ä—Ç</span>
                    </div>
                    <div class="car-tile" data-type="business">
                        <i class="fas fa-taxi"></i>
                        <span>–ë–∏–∑–Ω–µ—Å</span>
                    </div>
                    <div class="car-tile" data-type="minivan">
                        <i class="fas fa-shuttle-van"></i>
                        <span>–ú–∏–Ω–∏–≤—ç–Ω</span>
                    </div>
                </div>
            </div>

            <div id="priceCalculation" style="display: none;">
                <h3>–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="price">0</span> —Ä—É–±.</h3>
            </div>

            {% if 'user_id' in session %}
                <!-- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –∫–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ -->
                <button type="submit" class="submit-btn">–ù–∞–π—Ç–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—å</button>
            {% else %}
                <!-- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –∫–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ -->
                <p style="color: red; text-align: center;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –¥–ª—è –∑–∞–∫–∞–∑–∞ —Ç–∞–∫—Å–∏</p>
            {% endif %}
        </form>

        <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã -->
        <div id="map" style="width: 100%; height: 400px; display: none; margin-top: 20px;"></div>
        <button style="display: none" type="button" class="btn-location" id="approveAdress">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∞–¥—Ä–µ—Å</button>

        <div class="features">
            <div class="feature-card">
                <h3>–ë—ã—Å—Ç—Ä–æ</h3>
                <p>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø–æ–¥–∞—á–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è ‚Äî 3 –º–∏–Ω—É—Ç—ã</p>
            </div>
            <div class="feature-card">
                <h3>–í—ã–≥–æ–¥–Ω–æ</h3>
                <p>–õ—É—á—à–∏–µ —Ü–µ–Ω—ã –≤ –≥–æ—Ä–æ–¥–µ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</p>
            </div>
            <div class="feature-card">
                <h3>–ù–∞–¥–µ–∂–Ω–æ</h3>
                <p>–í—Å–µ –≤–æ–¥–∏—Ç–µ–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ç—Ä–æ–≥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É</p>
            </div>
            <div class="feature-card">
                <h3>–†–∞–±–æ—Ç–∞–µ–º 24/7</h3>
                <p>–û–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ª—É–≥–∏ –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ 365 –¥–Ω–µ–π –≤ –≥–æ–¥—É</p>
            </div>
        </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='js/logic.js') }}"></script>
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
    <!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ "–ü–æ–º–æ—â—å -->
<button class="floating-help" id="helpBtn">
    ?
</button>

    <!-- –û–∫–Ω–æ –ø–æ–¥—Å–∫–∞–∑–∫–∏ -->
<div class="help-popup hidden" id="helpPopup">
    <div class="help-header">
        <span>–ü–æ–º–æ—â—å</span>
        <button id="closeHelp">&times;</button>
    </div>
    <div class="help-body">
        <p>üöï –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∂–µ—Ç –≤–∞–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.</p>
        <p>üìç –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Ç–æ—á–∫—É –ø—Ä—è–º–æ –Ω–∞ –∫–∞—Ä—Ç–µ, –Ω–∞–∂–∞–≤ –Ω–∞ –≥–µ–æ–º–µ—Ç–∫—É –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞.</p>
        <p>üßæ –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ ‚Äî –º—ã —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –í–∞–º–∏ —Ç–∞—Ä–∏—Ñ–∞.</p>
        <p>üí° –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.
        <p>‚ùóÔ∏è –í–æ–∑–Ω–∏–∫–ª–∏ –∏–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º –Ω–∞ –≥–æ—Ä—è—á—É—é –ª–∏–Ω–∏—é –ø–æ –Ω–æ–º–µ—Ä—É: +7 (969) 282-30-60. </p>
    </div>
</div>
   <script>
    document.addEventListener("DOMContentLoaded", function () {
        const helpBtn = document.getElementById('helpBtn');
        const helpPopup = document.getElementById('helpPopup');
        const closeHelp = document.getElementById('closeHelp');

        helpBtn.addEventListener('click', () => {
            helpPopup.classList.remove('hidden');
        });

        closeHelp.addEventListener('click', () => {
            helpPopup.classList.add('hidden');
        });

        window.addEventListener('click', (e) => {
            if (!helpPopup.contains(e.target) && !helpBtn.contains(e.target)) {
                helpPopup.classList.add('hidden');
            }
        });
    });
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–º–æ—â–∏ —á–µ—Ä–µ–∑ 10 —Å–µ–∫ –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    setTimeout(() => {
        const pointA = document.getElementById('pointA').value;
        const pointB = document.getElementById('pointB').value;

        const helpAlreadyVisible = !helpPopup.classList.contains('hidden');

        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å, –µ—Å–ª–∏ –ø–æ–ª—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏ –æ–∫–Ω–æ –µ—â–µ —Å–∫—Ä—ã—Ç–æ
        if ((!pointA || !pointB) && !helpAlreadyVisible) {
            helpPopup.classList.remove('hidden');
        }
    }, 10000); // 10 —Å–µ–∫—É–Ω–¥
</script>

{% endblock %}